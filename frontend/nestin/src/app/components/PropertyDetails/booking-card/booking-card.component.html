<div class="card shadow-sm p-4 mb-4 rounded-3">
  <!-- Price Section -->
  <div class="d-flex align-items-end mb-4">
    <span class="fw-semibold display-6"
      >${{ property.pricePerNight | number }}</span
    >
    <span class="h5 text-muted ms-1">/night</span>
  </div>

  <!-- Date Picker -->
  <div class="row g-2 mb-3">
    <div class="col-md-6">
      <div class="form-floating">
        <input
          type="date"
          class="form-control"
          [(ngModel)]="checkInDate"
          [min]="today"
          id="checkInDate" />
        <label for="checkInDate">Check-in</label>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-floating">
        <input
          type="date"
          class="form-control"
          [(ngModel)]="checkOutDate"
          [min]="checkInDate || today"
          id="checkOutDate" />
        <label for="checkOutDate">Checkout</label>
      </div>
    </div>
  </div>

  <div class="guests-selector" (click)="showGuestModal = true">
    <label>GUESTS</label>
    <div class="guest-summary">{{ guestSummary }}</div>
  </div>

  <!-- Guest Selection Modal -->
  <div
    class="guest-modal"
    *ngIf="showGuestModal"
    (click)="$event.stopPropagation()">
    <div class="guest-modal-content">
      <div class="guest-type-row">
        <div>
          <div class="guest-type-label">Adults</div>
          <div class="guest-type-description">Ages 13 or above</div>
        </div>
        <div class="guest-counter">
          <button (click)="decrementGuestCount('adults', 0)">−</button>
          <span>{{ guestCounts.adults }}</span>
          <button (click)="guestCounts.adults = guestCounts.adults + 1">
            +
          </button>
        </div>
      </div>

      <div class="guest-type-row">
        <div>
          <div class="guest-type-label">Children</div>
          <div class="guest-type-description">Ages 2-12</div>
        </div>
        <div class="guest-counter">
          <button (click)="decrementGuestCount('children', 0)">−</button>
          <span>{{ guestCounts.children }}</span>
          <button (click)="guestCounts.children = guestCounts.children + 1">
            +
          </button>
        </div>
      </div>

      <div class="guest-type-row">
        <div>
          <div class="guest-type-label">Infants</div>
          <div class="guest-type-description">Under 2</div>
        </div>
        <div class="guest-counter">
          <button (click)="decrementGuestCount('infants', 0)">−</button>
          <span>{{ guestCounts.infants }}</span>
          <button (click)="guestCounts.infants = guestCounts.infants + 1">
            +
          </button>
        </div>
      </div>

      <div class="guest-type-row">
        <div>
          <div class="guest-type-label">Pets</div>
          <div class="guest-type-description">Bringing a service animal?</div>
        </div>
        <div class="guest-counter">
          <button (click)="decrementGuestCount('pets', 0)">−</button>
          <span>{{ guestCounts.pets }}</span>
          <button (click)="guestCounts.pets = guestCounts.pets + 1">+</button>
        </div>
      </div>

      <div class="container mt-5">
        <button
          class="btn w-100 btn-primary fw-semibold"
          (click)="showGuestModal = false">
          Close
        </button>
      </div>
    </div>
  </div>

  <button
    class="btn btn-primary fw-semibold"
    (click)="handleBookNow()"
    [disabled]="!checkInDate || !checkOutDate || isBooking">
    {{ isBooking ? 'Booking...' : 'Reserve' }}
  </button>

  <div class="price-summary" *ngIf="nights > 0">
    <div class="price-line">
      <span>${{ property.pricePerNight | number }} × {{ nights }} nights</span>
      <span>${{ subtotal | number }}</span>
    </div>
    <div class="price-line">
      <span>Cleaning fee</span>
      <span>${{ cleaningFee | number: '1.2-2' }}</span>
    </div>
    <div class="price-line">
      <span>Service fee</span>
      <span>${{ serviceFee | number: '1.2-2' }}</span>
    </div>
    <div class="price-line" *ngIf="extraGuestFee > 0">
      <span>Extra guest fee</span>
      <span>${{ extraGuestFee | number: '1.2-2' }}</span>
    </div>
    <div class="price-line" *ngIf="petFee > 0">
      <span>Pet fee</span>
      <span>${{ petFee | number: '1.2-2' }}</span>
    </div>

    <div class="price-line total">
      <span>Total before taxes</span>
      <span>${{ total | number: '1.2-2' }}</span>
    </div>
  </div>
</div>
