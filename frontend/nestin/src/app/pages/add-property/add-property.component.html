
<form [formGroup]="propertyForm" (ngSubmit)="onSubmit()" class="property-form">
    <div class="form-section">
      <h2>Basic Information</h2>
      
      <div class="form-group">
        <label for="title">Property Title <span class="required-asterisk" [class.invalid]="propertyForm.get('title')?.invalid && propertyForm.get('title')?.touched">*</span></label>
        <input id="title" type="text" formControlName="title" placeholder="e.g. Beautiful Beachfront Villa">
        <div *ngIf="propertyForm.get('title')?.invalid && propertyForm.get('title')?.touched" class="error-message">
          Title is required
        </div>
      </div>
      
      <div class="form-group">
        <label for="description">Description <span class="required-asterisk" [class.invalid]="propertyForm.get('description')?.invalid && propertyForm.get('description')?.touched">*</span></label>
        <textarea id="description" formControlName="description" rows="5" placeholder="Describe your property in detail"></textarea>
        <div *ngIf="propertyForm.get('description')?.invalid && propertyForm.get('description')?.touched" class="error-message">
          Description is required and should be at least 50 characters
        </div>
      </div>
      
      <div class="form-group">
        <label for="propertyType">Property Type <span class="required-asterisk" [class.invalid]="propertyForm.get('propertyType')?.invalid && propertyForm.get('propertyType')?.touched">*</span></label>
        <select id="propertyType" formControlName="propertyType">
          <option value="">Select property type</option>
          <option *ngFor="let type of propertyTypes" [value]="type.id">{{type.name}}</option>
        </select>
        <div *ngIf="propertyForm.get('propertyType')?.invalid && propertyForm.get('propertyType')?.touched" class="error-message">
          Property type is required
        </div>
      </div>
    </div>
    
    <div class="form-section">
      <h2>Location</h2>
      <div formGroupName="location">
        <div class="form-row">
          <div class="form-group">
            <label for="country">Country <span class="required-asterisk" [class.invalid]="propertyForm.get('location.country')?.invalid && propertyForm.get('location.country')?.touched">*</span></label>
            <input id="country" type="text" formControlName="country">
            <div *ngIf="propertyForm.get('location.country')?.invalid && propertyForm.get('location.country')?.touched" class="error-message">
              Country is required
            </div>
          </div>
          
          <div class="form-group">
            <label for="city">City <span class="required-asterisk" [class.invalid]="propertyForm.get('location.city')?.invalid && propertyForm.get('location.city')?.touched">*</span></label>
            <input id="city" type="text" formControlName="city">
            <div *ngIf="propertyForm.get('location.city')?.invalid && propertyForm.get('location.city')?.touched" class="error-message">
              City is required
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="state">State/Region</label>
            <input id="state" type="text" formControlName="state">
          </div>
          
          <!-- <div class="form-group">
            <label for="postalCode">Postal Code</label>
            <input id="postalCode" type="text" formControlName="postalCode">
          </div> -->
        </div>
        
        <div class="form-group">
          <label for="address">Street Address <span class="required-asterisk" [class.invalid]="propertyForm.get('location.address')?.invalid && propertyForm.get('location.address')?.touched">*</span></label>
          <input id="address" type="text" formControlName="address">
          <div *ngIf="propertyForm.get('location.address')?.invalid && propertyForm.get('location.address')?.touched" class="error-message">
            Address is required
          </div>
        </div>
        
        <div class="form-group">
          <label for="neighborhood">Neighborhood (optional)</label>
          <input id="neighborhood" type="text" formControlName="neighborhood">
        </div>
    </div>
        <div class="form-row">
          <div class="form-group">
            <label for="latitude">Latitude <span class="required-asterisk" [class.invalid]="propertyForm.get('latitude')?.invalid && propertyForm.get('latitude')?.touched">*</span>
            </label>
            <input id="latitude" type="number" step="0.000001" formControlName="latitude">
            <div *ngIf="propertyForm.get('latitude')?.invalid && propertyForm.get('latitude')?.touched" class="error-message">
              Latitude is required
            </div>
          </div>
          
          <div class="form-group">
            <label for="longitude">Longitude <span class="required-asterisk" [class.invalid]="propertyForm.get('longitude')?.invalid && propertyForm.get('longitude')?.touched">*</span></label>
            <input id="longitude" type="number" step="0.000001" formControlName="longitude">
            <div *ngIf="propertyForm.get('longitude')?.invalid && propertyForm.get('longitude')?.touched" class="error-message">
              Longitude is required
            </div>
          </div>
        </div>
    </div>
    

    <!-- add photos -->
    <div class="form-section">
        <h2>Photos <small>({{ previewUrls.length }}/{{ maxPhotos }})</small></h2>
        
        <div class="photo-upload-container">
          <input type="file" id="propertyPhotos" 
                 (change)="onFileSelected($event)" 
                 multiple accept="image/*" 
                 [disabled]="previewUrls.length >= maxPhotos"
                 class="file-input">
          <label for="propertyPhotos" class="upload-button">
            <i class="fas fa-camera"></i> Choose Photos
          </label>
          
          <div class="upload-requirements">
            <p>Upload at least 1 photos (max {{ maxPhotos }})</p>
            <p>Supported formats: JPG, PNG</p>
            <p>Max file size: 5MB</p>
          </div>
          
          <div class="photo-preview-grid" *ngIf="previewUrls.length > 0">
            <div class="photo-preview-item"
                 *ngFor="let url of previewUrls || []; let i = index"
                 [class.primary]="i === 0">
                 
              <img [src]="url" alt="Preview" class="preview-image" *ngIf="url">
              
              <div class="photo-actions">
                <button type="button" (click)="setPrimaryImage(i)" 
                        class="action-btn primary-btn" *ngIf="i !== 0">
                  <i class="fas fa-star"></i> Make Primary
                </button>
                <button type="button" (click)="removeImage(i)" 
                        class="action-btn danger-btn">
                  <i class="fas fa-trash"></i> Remove
                </button>
              </div>
          
              <div class="upload-progress" *ngIf="isUploading">
                <div class="progress-bar" [style.width.%]="uploadProgress[i]"></div>
                <span class="progress-text">{{ uploadProgress[i] }}%</span>
              </div>
          
              <div class="primary-badge" *ngIf="i === 0">
                <i class="fas fa-check"></i> Primary
              </div>
            </div>
          </div>
          
        </div>
      </div>


 <!-- avelability -->

 <div class="form-section">
  <h3>Availability</h3>
  <div formGroupName="availability" class="availability-group">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="checkInDate" class="form-label">Check-in Date 
          <span class="required-asterisk" [class.invalid]="propertyForm.get('startDate')?.invalid && propertyForm.get('startDate')?.touched">*</span>
        </label>
        <input 
          type="date" 
          id="checkInDate" 
          class="form-control" 
          formControlName="startDate" 
          [min]="today | date:'yyyy-MM-dd'"
          [class.is-invalid]="availability?.get('startDate')?.invalid && (availability?.get('startDate')?.dirty || availability?.get('startDate')?.touched)"
        >
        <div *ngIf="availability?.get('startDate')?.hasError('required') && (availability?.get('startDate')?.dirty || availability?.get('startDate')?.touched)" class="invalid-feedback">
          Check-in date is required
        </div>
      </div>
  
      <div class="col-md-6 mb-3">
        <label for="checkOutDate" class="form-label">Check-out Date 
          <span class="required-asterisk" [class.invalid]="propertyForm.get('endDate')?.invalid && propertyForm.get('endDate')?.touched">*</span>
        </label>
        <input 
          type="date" 
          id="checkOutDate" 
          class="form-control" 
          formControlName="endDate"
          [min]="(availability?.get('startDate')?.value ? (availability?.get('startDate')?.value | date:'yyyy-MM-dd') : (today | date:'yyyy-MM-dd'))"
          [class.is-invalid]="availability?.get('endDate')?.invalid && (availability?.get('endDate')?.dirty || availability?.get('endDate')?.touched)"
        >
        <div *ngIf="availability?.get('endDate')?.hasError('required') && (availability?.get('endDate')?.dirty || availability?.get('endDate')?.touched)" class="invalid-feedback">
          Check-out date is required
        </div>
      </div>
    </div>
    
    <!-- Display form group errors -->
    <div *ngIf="availability?.errors && (availability?.dirty || availability?.touched)" class="alert alert-danger">
      <div *ngIf="availability?.errors?.['pastDate']">
        <i class="bi bi-exclamation-circle"></i> Check-in date cannot be in the past
      </div>
      <div *ngIf="availability?.errors?.['dateRange']">
        <i class="bi bi-exclamation-circle"></i> Check-out date must be after check-in date
      </div>
    </div>
  </div>
  </div>
  
      
  
      <!-- amenity -->
      <!-- <div class="form-section">
        <h2>Amenities</h2>
        <div class="amenities-grid">
          <div *ngFor="let amenity of amenities" class="amenity-item">
            <input type="checkbox" 
                   [id]="'amenity-' + amenity.id" 
                   (change)="onAmenityChange($event, amenity)">
            <label [for]="'amenity-' + amenity.id">{{amenity.name}}</label>
          </div>
        </div>
      </div> -->


      <div class="form-section">
        <h2>Amenities</h2>
        
        <!-- Amenities Grid -->
        <div class="amenities-grid">
          <div *ngFor="let amenity of amenities" class="amenity-item">
            <input type="checkbox" 
                   [id]="'amenity-' + amenity.id" 
                   (change)="onAmenityChange($event, amenity)">
            <label [for]="'amenity-' + amenity.id">
              <i [class]="amenity.icon"></i> {{amenity.name}}
            </label>
          </div>
        </div>
      
        <!-- Pagination Controls -->
        <div class="pagination" *ngIf="totalPages > 1">
          <button (click)="goToPage(1)" [disabled]="currentPage === 1">
            &laquo;
          </button>
          <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
            &lsaquo;
          </button>
          
          <ng-container *ngFor="let page of getPageNumbers()">
            <button (click)="goToPage(page)" 
                    [class.active]="page === currentPage">
              {{page}}
            </button>
          </ng-container>
          
          <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
            &rsaquo;
          </button>
          <button (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
            &raquo;
          </button>
        </div>
      
        <!-- Loading Indicator -->
        <div *ngIf="loading" class="loading-indicator">
          Loading amenities...
        </div>
      </div>

    <!-- spaces -->
    <div class="form-section">
      <h2>Spaces</h2>
      <h3>Space Summaries (e.g., bedrooms, bathrooms)</h3>
      <div formArrayName="spaceSummaries">
        <div *ngFor="let space of spaceSummariesArray.controls; let i = index" 
          [formGroupName]="i" class="space-item">
          <div class="form-row">
            <div class="form-group">
              <label>Name</label>
              <input type="text" formControlName="name" placeholder="e.g. Bedrooms">
            </div>
            <div class="form-group">
              <label>Count</label>
              <input type="number" formControlName="count" min="1">
            </div>
            <button type="button" (click)="removeSpaceSummary(i)" class="remove-button">Remove</button>
          </div>
        </div>
        <button type="button" (click)="addSpaceSummary()" class="add-button">Add Space</button>
      </div>
      
      <h3>Space Item Summaries (e.g., beds, baths)</h3>
      <div formArrayName="spaceItemSummaries">
        <div *ngFor="let item of spaceItemSummariesArray.controls; let i = index" 
        [formGroupName]="i" class="space-item">
          <div class="form-row">
            <div class="form-group">
              <label>Name</label>
              <input type="text" formControlName="name" placeholder="e.g. Queen Beds">
            </div>
            <div class="form-group">
              <label>Count</label>
              <input type="number" formControlName="count" min="1">
            </div>
            <button type="button" (click)="removeSpaceItemSummary(i)" class="remove-button">Remove</button>
          </div>
        </div>
        <button type="button" (click)="addSpaceItemSummary()" class="add-button">Add Space Item</button>
      </div>
    </div>
    
    <div class="form-section">
      <h2>Details</h2>
      
      <div class="form-group">
        <label for="maxGuestCount">Maximum Guests 
          <span class="required-asterisk" [class.invalid]="propertyForm.get('maxGuestCount')?.invalid && propertyForm.get('maxGuestCount')?.touched">*</span>
        </label>
        <input id="maxGuestCount" type="number" formControlName="maxGuestCount" min="1">
        <div *ngIf="propertyForm.get('maxGuestCount')?.invalid && propertyForm.get('maxGuestCount')?.touched" class="error-message">
          Max Guests is required
        </div>
      </div>
      
      <div class="form-group">
        <label for="pricePerNight">Price Per Night ($)
          <span class="required-asterisk" [class.invalid]="propertyForm.get('pricePerNight')?.invalid && propertyForm.get('pricePerNight')?.touched">*</span>
        </label>
        <input id="pricePerNight" type="number" formControlName="pricePerNight" min="0">
        <div *ngIf="propertyForm.get('pricePerNight')?.invalid && propertyForm.get('pricePerNight')?.touched" class="error-message">
          Price Per Night is required
        </div>
      </div>
      
      <div class="form-group">
        <label for="safetyInfo">Safety Information 
          <span class="required-asterisk" [class.invalid]="propertyForm.get('safetyInfo')?.invalid && propertyForm.get('safetyInfo')?.touched">*</span>
        </label>
        <textarea id="safetyInfo" formControlName="safetyInfo" rows="3"></textarea>
        <div *ngIf="propertyForm.get('safetyInfo')?.invalid && propertyForm.get('safetyInfo')?.touched" class="error-message">
          Safe Info is required
        </div>
      </div>
      
      <div class="form-group">
        <label for="houseRules">House Rules
          <span class="required-asterisk" [class.invalid]="propertyForm.get('houseRules')?.invalid && propertyForm.get('houseRules')?.touched">*</span>
        </label>
        <textarea id="houseRules" formControlName="houseRules" rows="3"></textarea>
        <div *ngIf="propertyForm.get('houseRules')?.invalid && propertyForm.get('houseRules')?.touched" class="error-message">
          House Rules is required
        </div>
      </div>
      
      <div class="form-group">
        <label for="cancellationPolicy">Cancellation Policy
          <span class="required-asterisk" [class.invalid]="propertyForm.get('cancellationPolicy')?.invalid && propertyForm.get('cancellationPolicy')?.touched">*</span>
        </label>
        <textarea id="cancellationPolicy" formControlName="cancellationPolicy" rows="3"></textarea>
        <div *ngIf="propertyForm.get('cancellationPolicy')?.invalid && propertyForm.get('cancellationPolicy')?.touched" class="error-message">
          cancellation Policy is required
        </div>
      </div>
    </div>
    
    <div class="form-actions">
      <button type="submit" [disabled]="propertyForm.invalid || isLoading" class="submit-button">
      ADD
      </button>
    </div>
  </form>