<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Add New Property</h3>
        </div>
        <div class="card-body">
          
          <!-- Loading State -->
          <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading form data...</p>
          </div>
          
          <!-- Error State -->
          <div *ngIf="loadError && !isLoading" class="alert alert-danger">
            {{ loadError }}
            <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadFormData()">Retry</button>
          </div>
          
          <!-- Form Content -->
          <form *ngIf="!isLoading && !loadError" [formGroup]="propertyForm" (ngSubmit)="onSubmit()">
            <!-- Basic Information Section -->
            <div class="mb-4">
              <h5 class="mb-3 border-bottom pb-2">Basic Information</h5>
              
              <div class="mb-3">
                <label for="title" class="form-label">Property Title*</label>
                <input type="text" class="form-control" id="title" formControlName="title" 
                       placeholder="Give your property a descriptive title">
                <div *ngIf="propertyForm.get('title')?.invalid && (propertyForm.get('title')?.dirty || propertyForm.get('title')?.touched)"
                     class="text-danger">
                  <div *ngIf="propertyForm.get('title')?.hasError('required')">
                    Title is required
                  </div>
                  <div *ngIf="propertyForm.get('title')?.hasError('minlength')">
                    Title must be at least 5 characters long
                  </div>
                  <div *ngIf="propertyForm.get('title')?.hasError('maxlength')">
                    Title cannot exceed 100 characters
                  </div>
                  <div *ngIf="propertyForm.get('title')?.hasError('pattern')">
                    Only letters, numbers, spaces and basic punctuation (.,!?&-') are allowed
                  </div>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="description" class="form-label">Description*</label>
                <textarea class="form-control" id="description" formControlName="description" rows="4"
                          placeholder="Describe your property in detail"></textarea>
                <div *ngIf="propertyForm.get('description')?.invalid && (propertyForm.get('description')?.dirty || propertyForm.get('description')?.touched)"
                     class="text-danger">
                  <div *ngIf="propertyForm.get('description')?.hasError('required')">
                    Description is required
                  </div>
                  <div *ngIf="propertyForm.get('description')?.hasError('minlength')">
                    Description must be at least 10 characters long
                  </div>
                  <div *ngIf="propertyForm.get('description')?.hasError('maxlength')">
                    Description cannot exceed 1000 characters
                  </div>
                  <div *ngIf="propertyForm.get('description')?.hasError('pattern')">
                    Only letters, numbers, spaces and basic punctuation (.,!?&-'():;) are allowed
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Property Details Section -->
            <div class="mb-4">
              <h5 class="mb-3 border-bottom pb-2">Property Details</h5>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="propertyTypeId" class="form-label">Property Type*</label>
                  <select class="form-select" id="propertyTypeId" formControlName="propertyTypeId">
                    <option value="" disabled selected>Select property type</option>
                    <option *ngFor="let type of propertyTypes" [value]="type.id">
                      {{type.name}}
                    </option>
                  </select>
                  <div *ngIf="propertyForm.get('propertyTypeId')?.invalid && (propertyForm.get('propertyTypeId')?.dirty || propertyForm.get('propertyTypeId')?.touched)"
                       class="text-danger">
                    Property type is required
                  </div>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="locationId" class="form-label">Location*</label>
                  <select class="form-select" id="locationId" formControlName="locationId">
                    <option value="" disabled selected>Select location</option>
                    <option *ngFor="let location of locations" [value]="location.id">
                      {{location.name}}
                    </option>
                  </select>
                  <div *ngIf="propertyForm.get('locationId')?.invalid && (propertyForm.get('locationId')?.dirty || propertyForm.get('locationId')?.touched)"
                       class="text-danger">
                    Location is required
                  </div>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="pricePerNight" class="form-label">Price Per Night (USD)*</label>
                <div class="input-group">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" id="pricePerNight" formControlName="pricePerNight" 
                         min="0.01" step="0.01" placeholder="0.01">
                </div>
                <div *ngIf="propertyForm.get('pricePerNight')?.invalid && (propertyForm.get('pricePerNight')?.dirty || propertyForm.get('pricePerNight')?.touched)"
                     class="text-danger">
                  <div *ngIf="propertyForm.get('pricePerNight')?.hasError('required')">
                    Price is required
                  </div>
                  <div *ngIf="propertyForm.get('pricePerNight')?.hasError('min')">
                    Price must be at least $0.01
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Location Coordinates Section -->
            <div class="mb-4">
              <h5 class="mb-3 border-bottom pb-2">Location Coordinates</h5>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="latitude" class="form-label">Latitude*</label>
                  <input type="number" class="form-control" id="latitude" formControlName="latitude" 
                         min="-90" max="90" step="0.000001" placeholder="Between -90 and 90">
                  <div *ngIf="propertyForm.get('latitude')?.invalid && (propertyForm.get('latitude')?.dirty || propertyForm.get('latitude')?.touched)"
                       class="text-danger">
                    <div *ngIf="propertyForm.get('latitude')?.hasError('required')">
                      Latitude is required
                    </div>
                    <div *ngIf="propertyForm.get('latitude')?.hasError('min') || propertyForm.get('latitude')?.hasError('max')">
                      Must be between -90 and 90
                    </div>
                  </div>
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="longitude" class="form-label">Longitude*</label>
                  <input type="number" class="form-control" id="longitude" formControlName="longitude" 
                         min="-180" max="180" step="0.000001" placeholder="Between -180 and 180">
                  <div *ngIf="propertyForm.get('longitude')?.invalid && (propertyForm.get('longitude')?.dirty || propertyForm.get('longitude')?.touched)"
                       class="text-danger">
                    <div *ngIf="propertyForm.get('longitude')?.hasError('required')">
                      Longitude is required
                    </div>
                    <div *ngIf="propertyForm.get('longitude')?.hasError('min') || propertyForm.get('longitude')?.hasError('max')">
                      Must be between -180 and 180
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Policies Section -->
            <div class="mb-4">
              <h5 class="mb-3 border-bottom pb-2">Policies & Rules</h5>
              
              <div class="mb-3">
                <label for="safetyInfo" class="form-label">Safety Information*</label>
                <textarea class="form-control" id="safetyInfo" formControlName="safetyInfo" rows="3"
                placeholder="Important safety information for guests"></textarea>
                <div *ngIf="propertyForm.get('safetyInfo')?.invalid && (propertyForm.get('safetyInfo')?.dirty || propertyForm.get('safetyInfo')?.touched)"
                     class="text-danger">
                  <div *ngIf="propertyForm.get('safetyInfo')?.hasError('required')">
                    Safety information is required
                  </div>
                  <div *ngIf="propertyForm.get('safetyInfo')?.hasError('minlength')">
                    Must be at least 10 characters long
                  </div>
                  <div *ngIf="propertyForm.get('safetyInfo')?.hasError('maxlength')">
                    Cannot exceed 500 characters
                  </div>
                  <div *ngIf="propertyForm.get('safetyInfo')?.hasError('pattern')">
                    Only letters, numbers, spaces and basic punctuation (.,!?'"-) are allowed
                  </div>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="houseRules" class="form-label">House Rules*</label>
                <textarea class="form-control" id="houseRules" formControlName="houseRules" rows="3"
                          placeholder="Rules guests must follow"></textarea>
                <div *ngIf="propertyForm.get('houseRules')?.invalid && (propertyForm.get('houseRules')?.dirty || propertyForm.get('houseRules')?.touched)"
                     class="text-danger">
                  <div *ngIf="propertyForm.get('houseRules')?.hasError('required')">
                    House rules are required
                  </div>
                  <div *ngIf="propertyForm.get('houseRules')?.hasError('minlength')">
                    Must be at least 10 characters long
                  </div>
                  <div *ngIf="propertyForm.get('houseRules')?.hasError('maxlength')">
                    Cannot exceed 500 characters
                  </div>
                  <div *ngIf="propertyForm.get('houseRules')?.hasError('pattern')">
                    Only letters, numbers, spaces and basic punctuation (.,!?'"-) are allowed
                  </div>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="cancellationPolicy" class="form-label">Cancellation Policy*</label>
                <textarea class="form-control" id="cancellationPolicy" formControlName="cancellationPolicy" rows="3"
                          placeholder="Your cancellation policy"></textarea>
                <div *ngIf="propertyForm.get('cancellationPolicy')?.invalid && (propertyForm.get('cancellationPolicy')?.dirty || propertyForm.get('cancellationPolicy')?.touched)"
                     class="text-danger">
                  <div *ngIf="propertyForm.get('cancellationPolicy')?.hasError('required')">
                    Cancellation policy is required
                  </div>
                  <div *ngIf="propertyForm.get('cancellationPolicy')?.hasError('minlength')">
                    Must be at least 10 characters long
                  </div>
                  <div *ngIf="propertyForm.get('cancellationPolicy')?.hasError('maxlength')">
                    Cannot exceed 500 characters
                  </div>
                  <div *ngIf="propertyForm.get('cancellationPolicy')?.hasError('pattern')">
                    Only letters, numbers, spaces and basic punctuation (.,!?'"-) are allowed
                  </div>
                </div>
              </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button type="button" class="btn btn-outline-secondary me-md-2" (click)="onCancel()">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="!propertyForm.valid">Submit Property</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>